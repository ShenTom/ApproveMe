# ApproveMe API Documentation
  
## Description
The documentat for using ApproveMe server API. The server is deployed on [Glitch](glitch.com).

Server url: <https://approve-me-api.glitch.me/>
   
**INCLUDE THE ACCESS KEY IN THE HEADER TO USE THE API**

Sample Request Using Request Library

``` javascript
var request = require('request');

var options = {
    uri: url,
    method: 'POST',
    headers: {
        'Content-type': 'application/json',
        'access-key': access-key
    },
    json: msg
}

request(options, (err, resp, body)=> {
	console.log(JSON.parse(body));
});
```
- For more info about request, here is the link to its [official doc](https://github.com/request/request).


## API Endpoints

### Error message for any bad request

``` javascript
{ 
	"successful": false,
	"result": error message
}
```

### A Sample Response Request

``` javascript
{
    "_id": 1,
    "requester": "U79456HA5",
    "event": "Testing Add feature",
    "tagged": {
        "U79456HA5": 1,
        "U7A5FL7P1": 0
    },
    "date": "03-18-2018",
    "description": "Testingggg",
    "timestamp": 1525257024,
    "urgency": 2
}
```

### `/requests` [GET]
**GET Request**

Sample Response JSON

``` javascript
{ 
	"successful": true,
	"result": {
	    "accepted": [
	      {EVENT1},
	      ...
	    ],
	    "declined": [
	    	{EVENT2},
	    	...
	    ],
	    "pending": [
	    	{EVENT3},
	    	...
	    ]
	}
}
```

   * Return all the events in the database.


### `/requests/:req_id` [GET]
**GET Request**

Sample Response JSON

``` javascript
{ 
	"successful": true,
	"result": {EVENT}
}
```
   * Return the request object with the specific id.
   * Successful is false if an invalid req_id is entered.


### `/requests/users/:user_id` [GET]
**GET Request**

Sample Response JSON

``` javascript
{ 
	"successful": true,
	"result": {
	    "requested": [
	      {EVENT1},
	      ...
	    ],
	    "tagged": [
	    	{EVENT2},
	    	...
	    ]
	}
}
```
   * Return all the events associated to that user id, sorted in "requested" and "tagged" categories.


### `/requests` [POST]

**POST Request**

Sample Request JSON

```javascript
{
	"requester": "U79456HA5",
	"event": "Testing Add feature",
	"channel": "C8RQUTLU9",
	"tagged": {
	    "U79456HA5": 1,
	    "U7A5FL7P1": 0
	},
	"date": "03-18-2018",
	"description": "Testingggg",
	"urgency": 2
}
```


Sample Response JSON

```javascript
{
	"successful": true,
	"result": {
		"_id": 1,
		"requester": "U79456HA5",
		"event": "Testing Add feature",
		"tagged": {
		    "U79456HA5": 1,
		    "U7A5FL7P1": 0
		},
		"date": "03-18-2018",
		"description": "Testingggg",
		"timestamp": 1525257024,
		"urgency": 2
	}
}
```

   * Timestamp is generated by the server on the creation time.
   * **1**, **0**, and **-1** stand for **approved**, **pending**, and **declined** respectively.
   * There are three options for urgency: high (3), medium (2), and low (1). They are all represented as numbers in the database.


### `/requests/:req_id` [PUT]

**PUT Request**

Sample Request JSON

```javascript
{
	"event": "Testing Add feature",
	"tagged": {
	    "U79456HA5": 1,
	    "U7A5FL7P1": 0
	},
	"date": "03-18-2018",
	"description": "Testingggg",
	"urgency": 2
}
```


Sample Response JSON

```javascript
{
	"successful": true,
	"result": {
		"event": "Testing Add feature",
		"tagged": {
		    "U79456HA5": 1,
		    "U7A5FL7P1": 0
		},
		"date": "03-18-2018",
		"description": "Testingggg",
		"urgency": 2
	}
}
```
   
   * Send any of the updated field of the following: **tagged**, **event**, **date**, **description**, & **urgency**, is fine. ie. If the user only updates the event name, just send {"event": new_name}.
   * **Requester** and **channel** fields are not udpateable. 

### `/requests/:req_id` [DELETE]

**DELETE Request**

Sample Response JSON

```javascript
{
	"successful": true,
	"result": "The request with this request id has been removed."
}
```
   * Please use this endpoint carefully. Make sure to provide a confirmation message to the user before using this endpoint.

### `/requests/:req_id/users/:user_id` [POST]

**POST Request**

Sample Request JSON

```javascript
{
	"action": "approve"
}
```


Sample Response JSON

```javascript
{
	"successful": true,
	"result": {
		"_id": 1,
		"requester": "U79456HA5",
		"event": "Testing Add feature",
		"tagged": {
		    "U79456HA5": 1,
		    "U7A5FL7P1": 0
		},
		"date": "03-18-2018",
		"description": "Testingggg",
		"timestamp": 1525257024,
		"urgency": 2
	}
}
```

   * There are only three actions available for this endpoint: **approve**, **decline**, and **sendNotification**.
   * When one of the **approve** or **decline** action is sent, the user's status for the given request with the request id will be updated accordingly.
   * The **sendNotification** action is for the slack front end only. When that action is sent, the user will receive a new chat bot message about the given request with the request id.

  

